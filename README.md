# gorpc
Socket based RPC implementation for Google Protobufs in Python

Google protocol buffers offer a language-neutral, platform-neutral, extensible way of serializing structured data for communication across machine/language boundaries (services). It is here : https://github.com/google/protobuf

Protocol Buffers are very similar to the Apache Thrift protocol (used by Facebook for example), except that the public Protocol Buffers implementation does not include a concrete RPC protocol stack to use for defined services. Based on the 'service definition' stubs are created, which need to be implemented in order to have a working RPC service. This project aims to build a python implementation for the RPC stubs using Sockets

## Show me some code

** Write the Protobuf IDL (hotel_tag.proto for eg.)**
```
package protobuf.socketrpc;
option py_generic_services = true;
option java_generic_services = true;

message hotel_request{
    required string name =1 [default ="Zo rooms"];
}

message hotel {
    required string hn = 20 [default ="Taj Hotel "] ;
    required int32 restaurant_count = 9 [default = 1] ;
    required int32 minprice = 13 [default = 2000] ;
    required string hotel_url = 15 [default ="http://www.taj.com"] ;
    required int32 rating = 17 [default = 2] ;

}

service HotelService  
{
    rpc get_hotel_details(hotel_request) returns(hotel);
}

```

** Run the protobuf compiler to generate code and stubs **
```
protoc hotel_tag.proto --python_out=.
```
This generates hotel_tag_pb2.py which contains Service stub

** Implement the Service Stub **
```python
import hotel_tag_pb2 as pb_test


class hotel_service_impl(pb_test.HotelService):
    def get_hotel_details(self, controller, request, done):
        hotel = request.name
        response = pb_test.hotel()
        GetDataForHoel(hotel)
        # We're done, call the run method of the done callback
        done.run(response)
```

** Server **
```python
import os, sys
import gorpc.server
import hotel_tag_pb2 as pb_test # this was generated by the protobuf compiler
import hotel_service_imply


# create and fill test message
pb=pb_test.hotel()
pb.hn = "The Royal Marigold Hotel"


#create a greenlet and socket based RPC server
server = gorpc.server.GreenStreamServer(8090) 
#Register the service with the Server
server.registerService(hotel_service_imply.hotel_service_impl())
#Run!
server.run()

```

** Client **
```python

from  gorpc import RpcService
import hotel_tag_pb2 as pb_test

# Server details
hostname = 'localhost'
port = 8090

# Create a request
request = pb_test.hotel_request()
request.name = 'Hotel XYZ'


# Create a new service instance
hotel_service = RpcService(pb_test.HotelService_Stub,
                     port,
                     hostname)

response = hotel_service.get_hotel_details(request)

```

